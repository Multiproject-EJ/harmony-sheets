<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>FAQ / Support ‚Äî Harmony Sheets</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="assets/favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="style.css">
  <style>
.so-feedback {
  --bg: #f3f4f6;
  --panel: #ffffff;
  --muted: #6b7280;
  --ink: #0f172a;
  --accent: #f97316;
  --accent-soft: rgba(249,115,22,0.1);
  --radius-lg: 16px;
  --radius-sm: 10px;
  --gap: 1rem;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: radial-gradient(circle at 120% 10%, rgba(249,115,22,0.14), transparent 45%), #f3f4f6;
  max-width: 1100px;
  margin: 1.5rem auto 0;
  padding: clamp(1rem, 3vw, 1.8rem);
  color: var(--ink);
  box-sizing: border-box;
  border-radius: 20px;
}
.so-row {
  display: grid;
  grid-template-columns: 1.2fr 0.6fr;
  gap: 1rem;
}
@media (max-width: 980px) {
  .so-row { grid-template-columns: 1fr; }
}
.so-hero {
  background: linear-gradient(120deg, #fff7ed, #ffffff);
  border: 1px solid rgba(249,115,22,0.12);
  border-radius: 20px;
  padding: 1rem 1.3rem 1rem;
  display: flex;
  justify-content: space-between;
  gap: 1rem;
  margin-bottom: 1rem;
  align-items: center;
}
.so-hero h1 { font-size: 1rem; margin: 0 0 .4rem; }
.so-hero p { margin: 0; color: var(--muted); font-size: 0.72rem; max-width: 34rem; }
.so-hero-img { font-size: 2.4rem; filter: drop-shadow(0 10px 12px rgba(249,115,22,0.3)); }

.so-product-bar {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
  margin-bottom: 0.7rem;
}
.so-chip {
  background: #ffffff;
  border: 1px solid rgba(15,23,42,0.03);
  box-shadow: 0 5px 12px rgba(15,23,42,0.03);
  border-radius: 999px;
  padding: 0.35rem 0.7rem;
  font-size: 0.7rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 0.35rem;
}
.so-chip[data-active="true"] {
  background: rgba(249,115,22,0.1);
  border: 1px solid rgba(249,115,22,0.4);
  color: #c05621;
}
.so-admin-pill { background: #111827; color: #fff; }

.so-panel {
  background: var(--panel);
  border: 1px solid rgba(15,23,42,0.02);
  border-radius: var(--radius-lg);
  padding: 0.8rem;
  box-shadow: 0 20px 35px rgba(15,23,42,0.037);
  margin-bottom: 0.7rem;
}
.so-panel-title {
  font-size: 0.8rem;
  font-weight: 600;
  margin-bottom: .4rem;
  display: flex;
  justify-content: space-between;
  gap: .5rem;
  align-items: center;
}
.so-panel-sub { font-size: 0.65rem; color: var(--muted); margin-bottom: 0.6rem; }

.so-top3 { display: flex; flex-direction: column; gap: 0.5rem; }
.so-feature-card {
  background: #fff;
  border: 1px solid rgba(15,23,42,0.03);
  border-radius: 14px;
  padding: 0.5rem 0.6rem;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 0.6rem;
  transition: 0.12s ease;
  cursor: pointer;
}
.so-feature-card:hover { border-color: rgba(249,115,22,0.3); transform: translateY(-1px); }
.so-feature-info { flex: 1; }
.so-feature-title { font-size: 0.72rem; font-weight: 600; margin-bottom: 0.1rem; }
.so-feature-desc { font-size: 0.63rem; color: var(--muted); }

.so-vote-pill {
  background: rgba(249,115,22,0.1);
  border: 1px solid rgba(249,115,22,0.4);
  border-radius: 999px;
  padding: 0.1rem 0.45rem;
  font-size: 0.62rem;
  display: flex;
  align-items: center;
  gap: 0.25rem;
  cursor: pointer;
}

.so-cloud { display: flex; gap: 0.35rem; flex-wrap: wrap; align-items: center; }
.so-bubble {
  background: rgba(17, 24, 39, 0.03);
  border: 1px solid rgba(17,24,39,0.03);
  border-radius: 999px;
  padding: 0.25rem 0.6rem;
  font-size: 0.6rem;
  display: inline-flex;
  gap: 0.25rem;
  align-items: center;
  cursor: pointer;
  transition: .1s;
}
.so-bubble:hover { background: rgba(249,115,22,0.12); }
.so-bubble[data-size="lg"] { font-size: 0.75rem; padding: 0.35rem 0.7rem; }
.so-bubble[data-size="md"] { font-size: 0.68rem; }
.so-bubble[data-size="sm"] { opacity: 0.72; }

.so-add-own textarea {
  width: 100%;
  min-height: 75px;
  border-radius: 12px;
  border: 1px solid rgba(15,23,42,0.04);
  padding: 0.4rem 0.6rem;
  resize: vertical;
  font-family: inherit;
  font-size: 0.63rem;
  background: #fff;
}
.so-btn {
  background: #111827;
  color: #fff;
  border: none;
  border-radius: 999px;
  padding: 0.35rem 0.85rem;
  font-size: 0.62rem;
  cursor: pointer;
}
.so-btn-secondary { background: rgba(15,23,42,0.06); color: #111827; }

.faq-note {
  max-width: 1100px;
  margin: 1rem auto 0;
  font-size: 0.9rem;
  text-align: center;
}
.faq-note a {
  color: #f97316;
  font-weight: 600;
  text-decoration: none;
}
  </style>
</head>
<body class="theme-neutral">
<header class="site-header">
  <a class="brand" href="/">
    <img class="brand__logo" src="assets/logoHarmonySheets.webp" alt="">
    <span class="brand__text">
      <span class="brand__name">Harmony Sheets</span>
      <span class="brand__notice">Plan Better. Live Smarter.</span>
    </span>
  </a>
  <button class="nav-toggle" type="button" aria-expanded="false" aria-controls="site-menu">
    <span class="sr-only">Toggle navigation</span>
    <span class="nav-toggle__icon" aria-hidden="true"></span>
  </button>
  <nav class="main-nav" id="site-menu">
      <div class="nav-item nav-item--browse">
        <a class="nav-link nav-link--browse" href="products.html" aria-haspopup="true" aria-expanded="false">Discover Templates</a>
        <div class="nav-mega" role="menu" aria-label="Life Harmony categories">
          <div class="nav-mega__content" data-nav-mega-content>
            <p class="nav-mega__placeholder">Loading Life Harmony areas‚Ä¶</p>
          </div>
        </div>
      </div>
      <div class="nav-item nav-item--bundles">
        <a class="nav-link nav-link--bundles" href="bundles.html" aria-haspopup="true" aria-expanded="false">Bundles</a>
        <div class="nav-flyout" role="menu" aria-label="Featured bundles">
          <div class="nav-flyout__content" data-nav-bundles>
            <p class="nav-flyout__placeholder">Loading bundles‚Ä¶</p>
          </div>
        </div>
      </div>
      <a class="nav-link" href="faq.html">Community</a>
      <div class="nav-item nav-item--account" data-account-menu>
        <button class="nav-link nav-link--account nav-link--menu" type="button" data-account-toggle aria-haspopup="true" aria-expanded="false">
          <span class="nav-link__label" data-account-label>Log In/Sign Up</span>
          <span class="nav-link__chevron" aria-hidden="true"></span>
        </button>
        <div class="nav-dropdown" data-account-dropdown role="menu" aria-label="Account options" hidden>
          <a class="nav-dropdown__link" href="account.html" data-account-link="account">My account</a>
          <a class="nav-dropdown__link" href="offers.html" data-account-link="offers" hidden aria-hidden="true">My offers</a>
          <a class="nav-dropdown__link" href="admin_dashboard.html" data-account-link="admin" hidden aria-hidden="true">Admin dashboard</a>
          <a class="nav-dropdown__link" href="lovablesheet.html" data-account-link="lovablesheet" hidden aria-hidden="true">LovableSheet</a>
          <a class="nav-dropdown__link" href="products.html#my-products" data-account-link="products">My products</a>
          <button class="nav-dropdown__link nav-dropdown__link--action" type="button" data-account-cart>Shopping cart</button>
        </div>
      </div>
      <button class="nav-link nav-link--icon nav-link--cart" type="button" data-cart-toggle aria-expanded="false" aria-controls="cart-panel" hidden>
        <span class="sr-only" data-cart-label>View cart</span>
        <svg class="nav-link__icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <g fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3.5 4h2.6l1.6 9.2a1 1 0 0 0 1 .8h8.9a1 1 0 0 0 .97-.76L20 7.5H7.1"/>
            <circle cx="10" cy="18.5" r="1.25"/>
            <circle cx="17" cy="18.5" r="1.25"/>
          </g>
        </svg>
        <span class="cart-count" data-cart-count>0</span>
      </button>
    </nav>
</header>

<div class="cart-overlay" data-cart-overlay></div>
<aside class="cart-panel" id="cart-panel" aria-hidden="true" aria-labelledby="cart-panel-title" role="dialog" aria-modal="true">
  <div class="cart-panel__header">
    <h2 id="cart-panel-title">Your cart</h2>
    <button class="cart-panel__close" type="button" data-cart-close aria-label="Close cart">
      <span aria-hidden="true">√ó</span>
    </button>
  </div>
  <div class="cart-panel__body" data-cart-items></div>
  <div class="cart-panel__footer">
    <div class="cart-panel__total">
      <span>Total</span>
      <strong data-cart-total>$0.00</strong>
    </div>
    <button class="btn primary cart-panel__checkout" type="button" data-cart-checkout>Checkout</button>
    <p class="cart-panel__hint muted">Checkout grants instant access to your Harmony Sheets downloads.</p>
  </div>
</aside>

<main class="faq">
  <section class="life-parallax" aria-label="Harmony Sheets lifestyle inspiration">
    <div class="life-parallax__inner">
      <div class="life-parallax__overlay" aria-hidden="true">
        <img class="life-parallax__overlay-image" src="assets/topplx3.webp" alt="">
      </div>
    </div>
  </section>

  <header class="faq-header">
    <h1>FAQ / Support</h1>
    <p>We‚Äôre here to help you get the most from Harmony Sheets. Browse quick-start guides, answers, and reach out if you need a hand.</p>
  </header>

  <p class="faq-note">
    Didn‚Äôt find your answer? <a href="#faq-community">Tell us what to build ‚Üí</a>
  </p>

  <section id="guides" class="faq-guides anchor-section">
    <h2>Information Guides</h2>
    <p>Start with these resources to understand how Harmony Sheets templates support every area of your life.</p>
    <ul class="faq-guides__list">
      <li><a href="index.html#life-wheel">Explore the Life Harmony Wheel overview</a></li>
      <li><a href="products.html">Compare templates in the product catalog</a></li>
      <li><a href="bundles.html">See how bundle savings are structured</a></li>
    </ul>
  </section>

  <section id="faqs" class="faq-accordion anchor-section">
    <h2>Frequently Asked Questions</h2>
    <div class="faq-accordion__items">
      <details class="faq-item" open>
        <summary>How it works</summary>
        <p>Harmony Sheets templates provide elegant, app-like interfaces layered on top of familiar spreadsheet ‚Äúdatabases.‚Äù You make a personal copy, follow the guided prompts, and the dashboards, trackers, and automations respond instantly to your updates.</p>
      </details>
      <details class="faq-item">
        <summary>Running Google scripts</summary>
        <p>Most templates use formulas only, so they run anywhere Google Sheets works. When an add-on Google Apps Script is included, you‚Äôll see a clear notice and setup guide inside the file. Grant the requested permissions once, and the automation buttons‚Äîlike email sends or data resets‚Äîwill run on demand.</p>
      </details>
      <details class="faq-item">
        <summary>Do I need a subscription?</summary>
        <p>No. Harmony Sheets templates are one-time purchases. Once you create your copy, the file is yours to keep and customize.</p>
      </details>
      <details class="faq-item">
        <summary>Which apps do these spreadsheets use?</summary>
        <p>Every template is built for Google Sheets first. Many also include Excel-ready versions ‚Äî check the compatibility section on each product page.</p>
      </details>
      <details class="faq-item">
        <summary>Can I get updates?</summary>
        <p>Yes. Minor updates are free. We‚Äôll email buyers or post on the product page whenever new layouts, colors, or features are added.</p>
      </details>
      <details class="faq-item">
        <summary>What if I need a refund?</summary>
        <p>If a product doesn‚Äôt work as described, reach out. We‚Äôll troubleshoot together, and if we can‚Äôt fix it, we‚Äôll make it right with a refund or exchange.</p>
      </details>
    </div>
  </section>

  <section id="contact" class="faq-contact anchor-section">
    <h2>Contact</h2>
    <p>Complete the form and we‚Äôll respond within one business day. You can also email <a href="mailto:support@harmony-sheets.com">support@harmony-sheets.com</a>.</p>
    <form id="support-form" class="support">
      <input name="name" placeholder="Your name">
      <input name="email" type="email" required placeholder="Email">
      <input name="order" placeholder="Order # (optional)">
      <textarea name="message" rows="4" required placeholder="How can we help?"></textarea>
      <button class="btn primary">Send</button>
      <p id="support-status" class="muted"></p>
    </form>
  </section>

  <button id="hs-feedback-toggle" style="margin:1.5rem auto 0; display:block;">
    üí¨ Open community feedback
  </button>

  <section id="faq-community" class="so-feedback" style="display:none;">
    <div class="so-hero">
      <div>
        <h1>Community town square üè°</h1>
        <p>Pick the product you use ‚Üí vote on the top 3 things we should build ‚Üí or drop a new idea. Admins can view all products.</p>
      </div>
      <div class="so-hero-img">üßë‚Äçüé®</div>
    </div>

    <div class="so-row">
      <div>
        <div class="so-product-bar" id="soProductBar"></div>

        <div class="so-panel">
          <div class="so-panel-title">
            <span id="soCurrentProductTitle">Features</span>
            <button class="so-btn-secondary" id="soShowAllBtn">Show all</button>
          </div>
          <div class="so-panel-sub">Tap to vote. You can vote on up to 3 for this product.</div>
          <div class="so-top3" id="soTop3"></div>
        </div>

        <div class="so-panel">
          <div class="so-panel-title">
            <span>What people ask for (bubble size = votes)</span>
          </div>
          <div class="so-cloud" id="soCloud"></div>
        </div>

        <div class="so-panel">
          <div class="so-panel-title">
            <span>Add your own idea</span>
          </div>
          <div class="so-add-own">
            <textarea id="soIdeaInput" placeholder="Example: Let me export storyboards as transparent PNGs ‚Ä¶"></textarea>
            <div style="margin-top:0.4rem; display:flex; gap:0.45rem;">
              <button class="so-btn" id="soAddIdeaBtn">Submit idea</button>
              <span style="font-size:0.58rem; color:#6b7280;">We‚Äôll attach it to the selected product.</span>
            </div>
          </div>
        </div>
      </div>

      <div>
        <!-- EXISTING FAQ ALREADY ON PAGE, SO WE SKIP MINI FAQ HERE -->
        <div class="so-panel">
          <div class="so-panel-title">
            <span>Admin</span>
            <button class="so-btn-secondary" id="soToggleAdminBtn">Toggle</button>
          </div>
          <div class="so-panel-sub">In admin mode you see all products and raw vote counts.</div>
          <div id="soAdminInfo" style="font-size:0.6rem; color:#6b7280;"></div>
        </div>
      </div>
    </div>
  </section>
</main>

<footer class="site-footer">
  <div class="site-footer__inner">
    <div class="site-footer__grid">
      <div class="site-footer__column">
        <h3 class="site-footer__heading">Customer Support</h3>
        <ul class="site-footer__links">
          <li><a href="about.html">About</a></li>
          <li><a href="faq.html#guides">Information Guides</a></li>
          <li><a href="faq.html">Community</a></li>
          <li><a href="faq.html#contact">Contact Us</a></li>
        </ul>
      </div>
      <div class="site-footer__column">
        <h3 class="site-footer__heading">Policies</h3>
        <ul class="site-footer__links">
          <li><a href="policies.html#privacy">Privacy Policy</a></li>
          <li><a href="policies.html#delivery">Delivery Policy</a></li>
          <li><a href="policies.html#refund">Refund Policy</a></li>
          <li><a href="policies.html#terms">Terms of Service</a></li>
        </ul>
      </div>
      <div class="site-footer__column">
        <h3 class="site-footer__heading">Affiliate</h3>
        <ul class="site-footer__links">
          <li><a href="affiliate.html#apply">Become an Affiliate</a></li>
          <li><a href="affiliate.html#login">Affiliate Login</a></li>
        </ul>
      </div>
      <div class="site-footer__column site-footer__column--newsletter">
        <h3 class="site-footer__heading">Social &amp; Newsletter</h3>
        <form id="footer-newsletter" class="footer-form">
          <label class="sr-only" for="footer-email">Email address</label>
          <div class="footer-form__controls">
            <input id="footer-email" type="email" name="email" placeholder="Enter email" required>
            <button type="submit" class="footer-form__submit">Join</button>
          </div>
        </form>
        <p class="site-footer__note">Subscribe to receive exclusive releases, deals, and event updates.</p>
        <div class="site-footer__social">
          <a class="site-footer__social-link" href="https://www.instagram.com/harmonysheets" target="_blank" rel="noopener" aria-label="Instagram">
            <span aria-hidden="true">IG</span>
          </a>
          <a class="site-footer__social-link" href="https://www.youtube.com/@HarmonySheets" target="_blank" rel="noopener" aria-label="YouTube">
            <span aria-hidden="true">YT</span>
          </a>
          <a class="site-footer__social-link" href="https://www.pinterest.com/harmonysheets" target="_blank" rel="noopener" aria-label="Pinterest">
            <span aria-hidden="true">PI</span>
          </a>
          <a class="site-footer__social-link" href="mailto:support@harmony-sheets.com" aria-label="Email Harmony Sheets">
            <span aria-hidden="true">@</span>
          </a>
        </div>
        <p id="footer-newsletter-status" class="site-footer__status" role="status" aria-live="polite"></p>
      </div>
    </div>
    <div class="site-footer__bottom">
      <div class="site-footer__brand">
        <a class="brand brand--footer" href="/">Harmony Sheets</a>
        <p class="site-footer__copy">¬© <span id="year"></span> Harmony Sheets. All rights reserved.</p>
        <p class="site-footer__tagline">One-time purchase. No subscriptions.</p>
      </div>
      <div class="site-footer__extras">
        <p class="site-footer__locale">Serving customers worldwide ‚Ä¢ USD</p>
        <div class="site-footer__payments">
          <span class="site-footer__payment">Visa</span>
          <span class="site-footer__payment">Mastercard</span>
          <span class="site-footer__payment">Amex</span>
          <span class="site-footer__payment">PayPal</span>
          <span class="site-footer__payment">Shop Pay</span>
        </div>
      </div>
    </div>
  </div>
</footer>
<script src="app.js"></script>
<script type="module" src="auth-modal.js"></script>
<script>App.initFAQ()</script>
<script>
document.getElementById('hs-feedback-toggle').addEventListener('click', function() {
  const hub = document.getElementById('faq-community');
  const isHidden = hub.style.display === 'none' || hub.style.display === '';
  hub.style.display = isHidden ? 'block' : 'none';
});

(function() {
  // TODO: replace dummy arrays with Supabase fetch
  // ====== DUMMY DATA (replace with Supabase) ======
  const userProducts = [
    { id: "p-char", name: "Character Studio", emoji: "üé≠" },
    { id: "p-story", name: "Storyboard Pro", emoji: "üé¨" },
    { id: "p-write", name: "Screenwriting", emoji: "üìù" }
  ];
  const allProducts = [
    ...userProducts,
    { id: "p-assets", name: "Assets library", emoji: "üì¶" },
    { id: "p-ai", name: "AI scene maker", emoji: "ü§ñ" }
  ];
  const featuresByProduct = {
    "p-char": [
      { id:"f1", title:"PNG export (no BG)", desc:"Export clean characters for other tools.", votes: 32 },
      { id:"f2", title:"Pose presets", desc:"Click ‚Üí character shifts pose.", votes: 21 },
      { id:"f3", title:"Expression library", desc:"Happy/sad/shock etc.", votes: 17 },
      { id:"f4", title:"Color palettes", desc:"Save character styles.", votes: 9 }
    ],
    "p-story": [
      { id:"s1", title:"AI camera suggestions", desc:"Angle, zoom, shot type.", votes: 40 },
      { id:"s2", title:"Scene continuity checker", desc:"Keep characters consistent.", votes: 28 },
      { id:"s3", title:"PDF storyboard export", desc:"Share with clients.", votes: 12 }
    ],
    "p-write": [
      { id:"w1", title:"Beat sheet view", desc:"High-level outline first.", votes: 14 },
      { id:"w2", title:"Export to Final Draft", desc:"One-click export.", votes: 26 },
      { id:"w3", title:"Character arc assistant", desc:"Track motivation by scene.", votes: 7 }
    ],
    "p-assets": [
      { id:"a1", title:"Tagging system", desc:"Find props faster.", votes: 6 }
    ],
    "p-ai": [
      { id:"ai1", title:"Image-to-scene", desc:"Use ref image and generate variations.", votes: 33 }
    ]
  };

  let isAdmin = false;
  let currentProductId = userProducts[0].id;
  const voteTracker = {}; // { productId: Set([...featureIds]) }

  const productBar = document.getElementById("soProductBar");
  const top3El = document.getElementById("soTop3");
  const cloudEl = document.getElementById("soCloud");
  const currentProductTitle = document.getElementById("soCurrentProductTitle");
  const adminInfo = document.getElementById("soAdminInfo");

  function getVisibleProducts() {
    return isAdmin ? allProducts : userProducts;
  }

  function getProductName(id) {
    const all = [...userProducts, ...allProducts];
    const f = all.find(p => p.id === id);
    return f ? f.name : "Product";
  }

  function renderProducts() {
    const list = getVisibleProducts();
    productBar.innerHTML = "";
    list.forEach(p => {
      const chip = document.createElement("button");
      chip.className = "so-chip";
      if (p.id === currentProductId) chip.dataset.active = "true";
      chip.innerHTML = `${p.emoji} ${p.name}`;
      chip.addEventListener("click", () => {
        currentProductId = p.id;
        renderProducts();
        renderForCurrentProduct();
      });
      productBar.appendChild(chip);
    });
    if (isAdmin) {
      const adminChip = document.createElement("span");
      adminChip.className = "so-chip so-admin-pill";
      adminChip.textContent = "Admin view";
      productBar.appendChild(adminChip);
    }
  }

  function renderForCurrentProduct() {
    const feats = featuresByProduct[currentProductId] || [];
    currentProductTitle.textContent = `Features for ${getProductName(currentProductId)}`;
    const sorted = [...feats].sort((a,b) => b.votes - a.votes);
    const top3 = sorted.slice(0,3);

    top3El.innerHTML = "";
    top3.forEach(ft => {
      const card = document.createElement("div");
      card.className = "so-feature-card";
      card.innerHTML = `
        <div class="so-feature-info">
          <div class="so-feature-title">${ft.title}</div>
          <div class="so-feature-desc">${ft.desc}</div>
        </div>
        <button class="so-vote-pill" data-id="${ft.id}">
          ‚ñ≤ ${ft.votes}
        </button>
      `;
      top3El.appendChild(card);
    });

    cloudEl.innerHTML = "";
    sorted.forEach(ft => {
      const bubble = document.createElement("button");
      bubble.className = "so-bubble";
      bubble.dataset.size =
        ft.votes > 30 ? "lg" :
        ft.votes > 15 ? "md" : "sm";
      bubble.textContent = `${ft.title} (${ft.votes})`;
      bubble.addEventListener("click", () => voteFeature(ft.id));
      cloudEl.appendChild(bubble);
    });

    updateAdminInfo();
  }

  function voteFeature(featureId) {
    const feats = featuresByProduct[currentProductId];
    if (!feats) return;
    const ft = feats.find(f => f.id === featureId);
    if (!ft) return;

    if (!voteTracker[currentProductId]) voteTracker[currentProductId] = new Set();
    const userVotes = voteTracker[currentProductId];

    if (userVotes.has(featureId)) {
      userVotes.delete(featureId);
      ft.votes = Math.max(0, ft.votes - 1);
    } else {
      if (userVotes.size >= 3) {
        alert("You can vote on max 3 features for this product right now.");
        return;
      }
      userVotes.add(featureId);
      ft.votes += 1;
      // TODO: on vote, POST to /rpc/upsert_vote
    }

    renderForCurrentProduct();
  }

  top3El.addEventListener("click", (e) => {
    const btn = e.target.closest(".so-vote-pill");
    if (!btn) return;
    voteFeature(btn.dataset.id);
  });

  document.getElementById("soAddIdeaBtn").addEventListener("click", () => {
    const text = document.getElementById("soIdeaInput").value.trim();
    if (!text) return;
    const feats = featuresByProduct[currentProductId] || (featuresByProduct[currentProductId] = []);
    feats.push({
      id: "u" + Date.now(),
      title: text,
      desc: "User idea",
      votes: 0
    });
    document.getElementById("soIdeaInput").value = "";
    renderForCurrentProduct();
  });

  document.getElementById("soToggleAdminBtn").addEventListener("click", () => {
    isAdmin = !isAdmin;
    renderProducts();
    renderForCurrentProduct();
  });

  document.getElementById("soShowAllBtn").addEventListener("click", () => {
    alert("TODO: open modal / new page with full feature list for " + getProductName(currentProductId));
  });

  function updateAdminInfo() {
    if (!isAdmin) {
      adminInfo.textContent = "Admin mode off.";
      return;
    }
    const feats = featuresByProduct[currentProductId] || [];
    const totalVotes = feats.reduce((sum,f) => sum + f.votes, 0);
    adminInfo.textContent = `Product: ${getProductName(currentProductId)} ‚Ä¢ Features: ${feats.length} ‚Ä¢ Total votes: ${totalVotes}`;
  }

  // TODO: read user_id and is_admin from current session
  // init
  renderProducts();
  renderForCurrentProduct();
})();
</script>
</body>
</html>
